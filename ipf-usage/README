###############################################################################
# ipf-usage installation instructions
# 
# ipf-usage execution:
#    1. cron or interactive execution of upload_rabbitmq.sh
#    2. upload_rabbitmq.sh executes
#       upload_usage.py with a custom configuration file
#    3. upload_usage.py 
#       a. scans a configured directory for files matching a configured glob
#       b. selects files that haven't been uploaded or changed since uploaded
#       c. parses/converts each file if a parser was configured
#       d. uploads each file or parsed/converted file to a configured target
#       e. tracks previously uploaded files in a status file to not reprocess them
###############################################################################

Pre-requisites:
  - Python with Virtualenv

1) As root create the install directory owned by the account that will upload usage
  $ mkdir /soft/ipf-usage
  $ chown <owner>.<group> /soft/ipf-usage

For the remaining steps, switch to the account that will upload files

2) Install package(s)
  $ mkdir /soft/ipf-usage/PROD
  $ cd    /soft/ipf-usage/PROD
  $ svn co https://software.xsede.org/svn/xci/source/usage-analysis/ipf-usage/trunk/ ./

3) Configure package(s)
  # Create local directories
  $ mkdir /soft/ipf-usage/conf
  $ mkdir /soft/ipf-usage/var

  # Generate SSH keys without a passphrase
  $ ssh-keygen -t rsa -f /soft/ipf-usage/conf/id_rsa
  # Send the id_rsa.pub public key to the Usage Collection Service administrators

  # Create the configuration files
  $ cp /soft/ipf-usage/PROD/conf/upload_rabbitmq.conf.example \
       /soft/ipf-usage/conf/upload_rabbitmq.conf

  # Edit upload_rabbitmq.conf to configure

  # Set PYTHON_BASE as appropriate
  vi PROD/bin/python-venv-init.sh
  vi PROD/bin/upload_rabbitmq.sh

4) Generate a custom Python venv with some required packages
  $ /soft/ipf-usage/PROD/bin/python-venv-init.sh

5) Test and run in production
  # Test by hand
  $ /soft/ipf-usage/PROD/bin/upload_rabbimq.sh
  # Check logs in var/ and status in conf/
  # Install in cron
  0 6 * * 1 /soft/ipf-usage/PROD/bin/upload_rabbitmq.sh
